{% extends 'base.html' %} {% block head %}
<title>usecase2ml - search</title>
{% endblock %} {% block body %}
<div class="container min-vh-100">
  <!-- d-flex flex-column justify-content-center align-items-center -->
  <div class="row mt-3">
    <!-- Search Field -->
    <div class="container">
      <form action="/" method="POST">
        <div class="form-group row">
          <div class="col-sm-2">
            <label for="search" class="col-form-label">Search</label>
          </div>
          <div class="col-sm-8">
            <input
              type="text"
              class="form-control form-control-lg"
              id="search"
              name="search"
              value="{{ query.query }}"
            />
          </div>
        </div>

        <!-- Mode -->
        <div id="mode" class="">
          <div class="form-group row">
            <div class="col-sm-2">Mode</div>
            <div class="col-sm-10">
              <div class="btn-group btn-group-toggle" data-toggle="buttons">
                <label class="btn btn-secondary">
                  <input type="radio" name="all" id="all" class="toggle"
                  autocomplete="off" {{ query_mode['all'] }} /> All
                </label>
                <label class="btn btn-secondary">
                  <input type="radio" name="learn" id="learn" class="toggle"
                  autocomplete="off" {{ query_mode['learn'] }} /> Learn
                </label>
                <label class="btn btn-secondary">
                  <input type="radio" name="explore" id="explore" class="toggle"
                  autocomplete="off" {{ query_mode['explore'] }} /> Explore
                </label>
                <label class="btn btn-secondary">
                  <input type="radio" name="compete" id="compete" class="toggle"
                  autocomplete="off" {{ query_mode['compete'] }} /> Compete
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- Options -->
        <div id="options" class="{{ show_filter }}">
          <!-- Query Engines -->
          <div id="engines" class="">
            <div class="form-group row">
              <div class="col-sm-2">Queries</div>
              <div class="col-sm-10">
                <div>
                  <div class="form-check form-check-inline col-sm-2">
                    <input class="form-check-input" type="checkbox" id="k"
                    name="k" {{ query_engines['k'] }} />
                    <label class="form-check-label" for="gridCheck1">
                      Keyword Based
                    </label>
                  </div>
                  <!-- <div class="form-check form-check-inline col-sm-4">
                    <input class="form-check-input" type="checkbox" id="ks"
                    name="ks" {{ query_engines['ks'] }} />
                    <label class="form-check-label" for="gridCheck1">
                      Keyword Summarization
                    </label>
                  </div> -->
                  <!-- </div>

                <div> -->
                  <div class="form-check form-check-inline col-sm-3">
                    <input class="form-check-input" type="checkbox" id="s"
                    name="s" {{ query_engines['s'] }} />
                    <label class="form-check-label" for="gridCheck1">
                      Semantic Search
                    </label>
                  </div>
                  <!-- <div class="form-check form-check-inline col-sm-4">
                    <input class="form-check-input" type="checkbox" id="ss"
                    name="ss" {{ query_engines['ss'] }} />
                    <label class="form-check-label" for="gridCheck1">
                      Semantic Summarization
                    </label>
                  </div> -->
                </div>
                <div>
                  <div class="form-check form-check-inline col-sm-2">
                    <input class="form-check-input" type="radio" id="title"
                    name="field" value="title" {{ query_secondary['t'] }} />
                    <label class="form-check-label" for="gridCheck1">
                      Title
                    </label>
                  </div>
                  <div class="form-check form-check-inline col-sm-2">
                    <input class="form-check-input" type="radio"
                    id="summarization" name="field" value="summarization" {{
                    query_secondary['s'] }} />
                    <label class="form-check-label" for="gridCheck1">
                      Summarization
                    </label>
                  </div>
                  <div class="form-check form-check-inline col-sm-2">
                    <input class="form-check-input" type="radio" id="fulltext"
                    name="field" value="fulltext" {{ query_secondary['f'] }} />
                    <label class="form-check-label" for="gridCheck1">
                      Full Text
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Filters -->
          <!-- <div id="filter" class="{{ show_filter }}"> -->
          <div id="filter" class="">
            <div class="form-group row">
              <div class="col-sm-2">Filter</div>
              <div class="col-sm-10">
                <!-- first row -->
                <div>
                  <div class="form-check form-check-inline">
                    <input
                      class="form-control form-control-sm"
                      type="text"
                      placeholder="category"
                      id="category"
                      name="category"
                      value="{{ query.category }}"
                      autocomplete="off"
                      list="category_list"
                    />
                  </div>

                  <div class="form-check form-check-inline">
                    <input
                      class="form-control form-control-sm"
                      type="text"
                      placeholder="subcategory"
                      id="subcategory"
                      name="subcategory"
                      value="{{ query.subcategory }}"
                      autocomplete="off"
                      list="subcategory_list"
                    />
                  </div>

                  <div class="form-check form-check-inline">
                    <input
                      class="form-control form-control-sm"
                      type="text"
                      placeholder="tags"
                      id="tags"
                      name="tags"
                      value="{{ query.tags }}"
                      autocomplete="off"
                      list="tags_list"
                    />
                  </div>

                  <div class="form-check form-check-inline">
                    <input
                      class="form-control form-control-sm"
                      type="text"
                      placeholder="kind"
                      id="kind"
                      name="kind"
                      value="{{ query.kind }}"
                      autocomplete="off"
                      list="kind_list"
                    />
                  </div>
                </div>

                <!-- second row -->
                <div>
                  <div class="form-check form-check-inline">
                    <input
                      class="form-control form-control-sm"
                      type="text"
                      placeholder="ml_libs"
                      id="ml_libs"
                      name="ml_libs"
                      value="{{ query.ml_libs }}"
                      autocomplete="off"
                      list="libs_list"
                    />
                  </div>

                  <div class="form-check form-check-inline">
                    <input
                      class="form-control form-control-sm"
                      type="text"
                      placeholder="host"
                      id="host"
                      name="host"
                      value="{{ query.host }}"
                      autocomplete="off"
                      list="host_list"
                    />
                  </div>

                  <div class="form-check form-check-inline">
                    <input
                      class="form-control form-control-sm"
                      type="text"
                      placeholder="tags not"
                      id="tags_not"
                      name="tags_not"
                      value="{{ query_not.tags }}"
                      autocomplete="off"
                      list="tags_list"
                    />
                  </div>

                  <div class="form-check form-check-inline">
                    <input
                      class="form-control form-control-sm"
                      type="text"
                      placeholder="kind not"
                      id="kind_not"
                      name="kind_not"
                      value="{{ query_not.kind }}"
                      autocomplete="off"
                      list="kind_list"
                    />
                  </div>

                  <!-- <div class="form-check form-check-inline">
                    <input
                      class="form-control form-control-sm"
                      type="text"
                      placeholder="ml_libs not"
                      id="ml_libs_not"
                      name="ml_libs_not"
                      value="{{ query_not.ml_libs }}"
                      autocomplete="off"
                      list="libs_list"
                    />
                  </div> -->

                  <!-- <div class="form-check form-check-inline">
                    <input
                      class="form-control form-control-sm"
                      type="text"
                      placeholder="host not"
                      id="host_not"
                      name="host_not"
                      value="{{ query_not.host_not }}"
                      autocomplete="off"
                      list="host_list"
                    />
                  </div> -->
                </div>

                <!-- autocomplete -->
                <datalist id="category_list">
                  {% for item in js.category %}
                  <option value="{{ item }}"></option>
                  {% endfor %}
                </datalist>
                <datalist id="subcategory_list">
                  {% for item in js.subcategory %}
                  <option value="{{ item }}"></option>
                  {% endfor %}
                </datalist>
                <datalist id="tags_list">
                  {% for item in js.tags %}
                  <option value="{{ item }}"></option>
                  {% endfor %}
                </datalist>
                <datalist id="kind_list">
                  {% for item in js.kind %}
                  <option value="{{ item }}"></option>
                  {% endfor %}
                </datalist>
                <datalist id="libs_list">
                  {% for item in js.ml_libs %}
                  <option value="{{ item }}"></option>
                  {% endfor %}
                </datalist>
                <datalist id="host_list">
                  {% for item in js.host %}
                  <option value="{{ item }}"></option>
                  {% endfor %}
                </datalist>
              </div>
            </div>
          </div>

          <!-- Embeddings -->
          <div id="embeddings" class="">
            <div class="form-group row">
              <div class="col-sm-2">Embedding</div>
              <div class="col-sm-10">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="model"
                  id="use" value="use" {{ embeddings['use'] }} />
                  <label class="form-check-label" for="use"> USE4 (DAN) </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="model"
                  id="use_large" value="use_large" {{ embeddings['use_large'] }}
                  />
                  <label class="form-check-label" for="use_large">
                    USE5 large (Transformer)
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Boosting -->
          <!-- <div id="boosting" class="">
            <div class="form-group row">
              <div class="col-sm-2">Boosting</div>
              <div class="col-sm-10">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="boosting"
                  id="boosting_false" value="false" {{ boosting['false'] }} />
                  <label class="form-check-label" for="boosting_false"
                    >do not boost engagement score</label
                  >
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="boosting"
                  id="boosting_true" value="true" {{ boosting['true'] }} />
                  <label class="form-check-label" for="boosting_true"
                    >boost engagement score (10x)</label
                  >
                </div>
              </div>
            </div>
          </div> -->
        </div>

        <!-- Options Toggle -->
        <div class="form-group row">
          <div class="col-sm-2">
            <a onClick="toggle(options); return false;" href="#">More</a>
          </div>
        </div>

        <!-- Submit -->
        <div class="form-group row">
          <div class="col-sm-2">
            <button type="submit" class="btn btn-primary">Search</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <div class="row">
    <div class="container">
      {% if items|length < 1 %}
      <h4 style="text-align: center">no query - no results ...</h4>
      {% else %}
      <div class="table-responsive">
        <table class="table table-striped" id="myTable" style="width: 100%">
          <thead class="thead-dark">
            <tr>
              <th>Search</th>
              <th>Score</th>
              <th style="width: 100%">Item</th>
              <!-- <th>Score</th> -->
              <th>Date<!--(Project)--></th>
            </tr>
          </thead>

          <tbody>
            {% for item in items %}
            <tr>
              <td>
                <div class="container">
                  <div class="row">{{ item.search }}</div>
                </div>
              </td>
              <td>
                <div class="container">
                  <div class="row">{{ item.search_score }}</div>
                </div>
              </td>
              <td>
                <div class="container">
                  <div class="row font-weight-bold">
                    <a
                      onClick="toggle({{ item.index }}); return false;"
                      href="#"
                      >{{ item.title }}</a
                    >
                  </div>

                  <div id="{{ item.index }}" class="hidden">
                    <div class="row mt-3 mb-3">
                      <div class="col-sm-2 font-weight-bold">link</div>
                      <div class="col-sm-10">
                        <a href="{{ item.link }}" target="_blank"
                          >{{ item.link }}</a
                        >
                      </div>
                      <!-- summarization -->
                      {% if item.summarization is defined %}
                      <div class="col-sm-2 font-weight-bold">summarization</div>
                      <div class="col-sm-10">
                        {{ item.summarization }} ({{ item.words }} words)
                      </div>
                      {% endif %}

                      <!-- fulltext -->
                      {% if item.fulltext is defined and query_secondary['f'] ==
                      'checked' %}
                      <!-- <div class="col-sm-2 font-weight-bold">fulltext</div>
                      <div class="col-sm-10">{{ item.fulltext }}</div> -->
                      {% endif %}

                      <!-- words -->
                      {% if item.words is defined %}
                      <!-- <div class="col-sm-2 font-weight-bold">words</div>
                      <div class="col-sm-10">{{ item.words }}</div> -->
                      {% endif %}

                      <!-- category -->
                      {% if item.category is defined %}
                      <div class="col-sm-2 font-weight-bold">category</div>
                      <div class="col-sm-10">
                        {{ item.category }} (score: {{ item.category_score }})
                      </div>
                      {% endif %}

                      <!-- subcategory -->
                      {% if item.subcategory is defined %}
                      <div class="col-sm-2 font-weight-bold">subcategory</div>
                      <div class="col-sm-10">
                        {{ item.subcategory }} (score: {{ item.subcategory_score
                        }})
                      </div>
                      {% endif %}

                      <!-- tags -->
                      {% if item.tags is defined and item.tags|length > 0 %}
                      <div class="col-sm-2 font-weight-bold">tags</div>
                      <div class="col-sm-10">{{ ', '.join(item.tags) }}</div>
                      {% endif %}

                      <!-- kind -->
                      {% if item.kind is defined %}
                      <div class="col-sm-2 font-weight-bold">kind</div>
                      {% if item.kind is not string %}
                      <div class="col-sm-10">{{ ', '.join(item.kind) }}</div>
                      {% else %}
                      <div class="col-sm-10">{{ item.kind }}</div>
                      {% endif %} {% endif %}

                      <!-- libraries -->
                      {% if item.ml_libs is defined %}
                      <div class="col-sm-2 font-weight-bold">ml libs</div>
                      <div class="col-sm-10">{{ ', '.join(item.ml_libs) }}</div>
                      {% endif %}

                      <!-- host -->
                      {% if item.host is defined %}
                      <div class="col-sm-2 font-weight-bold">source</div>
                      <div class="col-sm-10">{{ item.host }}</div>
                      {% endif %}

                      <!-- license -->
                      {% if item.license is defined %}
                      <!-- <div class="col-sm-2 font-weight-bold">license</div>
                      <div class="col-sm-10">{{ item.license }}</div> -->
                      {% endif %}

                      <!-- language -->
                      {% if item.language is defined %}
                      <div class="col-sm-2 font-weight-bold">language</div>
                      <div class="col-sm-10">{{ item.language }}</div>
                      {% endif %}

                      <!-- search_score -->
                      {% if item.search_score is defined %}
                      <!-- <div class="col-sm-2 font-weight-bold">search score</div>
                      <div class="col-sm-10">{{ item.search_score }}</div> -->
                      {% endif %}

                      <!-- engagement_score -->
                      {% if item.engagement_score is defined %}
                      <div class="col-sm-2 font-weight-bold">engagement</div>
                      <div class="col-sm-10">{{ item.engagement_score }}</div>
                      {% endif %}

                      <!-- ml_score -->
                      {% if item.ml_score is defined %}
                      <div class="col-sm-2 font-weight-bold">ml score</div>
                      <div class="col-sm-10">{{ item.ml_score }}</div>
                      {% endif %}

                      <!-- learn_score -->
                      {% if item.learn_score is defined %}
                      <div class="col-sm-2 font-weight-bold">learn score</div>
                      <div class="col-sm-10">{{ item.learn_score }}</div>
                      {% endif %}

                      <!-- explore_score -->
                      {% if item.explore_score is defined %}
                      <div class="col-sm-2 font-weight-bold">explore score</div>
                      <div class="col-sm-10">{{ item.explore_score }}</div>
                      {% endif %}

                      <!-- compete_score -->
                      {% if item.compete_score is defined %}
                      <div class="col-sm-2 font-weight-bold">compete score</div>
                      <div class="col-sm-10">{{ item.compete_score }}</div>
                      {% endif %}

                      <!-- date -->
                      {% if item.date_project is defined %}
                      <div class="col-sm-2 font-weight-bold">date</div>
                      <div class="col-sm-10">
                        {{ item.date_project.split('T')[0] }}
                      </div>
                      {% endif %}

                      <!-- id -->
                      {% if item.id|length > 0 %}
                      <!-- <div class="col-sm-2 font-weight-bold">id</div>
                      <div class="col-sm-10">{{ item.id }}</div> -->
                      {% endif %}
                    </div>
                  </div>
                </div>
              </td>
              <!-- <td>
                <div class="container">
                  <div class="row">
                    {% if item.score != None %} {{ item.score }} {% endif %}
                  </div>
                </div>
              </td> -->
              <td>
                <div class="container">
                  <div class="row">
                    {% if item.date_project is defined %}{{
                    item.date_project.split('T')[0] }}{% endif %}
                  </div>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div>Query Runtime: {{ runtime }} sec</div>
    </div>

    {% endif %}
  </div>
</div>
{% endblock %}
